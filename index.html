<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AeroGuard: Hospital BioRisk Analytics</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Markdown-like styling for AI response */
        .prose p { margin-bottom: 0.75rem; }
        .prose ul { list-style-type: disc; padding-left: 1.25rem; margin-bottom: 0.75rem; }
        .prose strong { font-weight: 600; color: #1e293b; }

        /* Custom Animations */
        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse-soft {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .animate-enter {
            animation: slideUpFade 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .animate-pulse-soft {
            animation: pulse-soft 2s infinite ease-in-out;
        }

        /* Smooth transitions for interactive elements */
        .btn-interactive {
            transition: all 0.2s ease;
        }
        .btn-interactive:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const Icons = {
            Activity: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
            Calculator: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            Shield: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/></svg>,
            FileText: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>,
            Info: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>,
            AlertTriangle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>,
            CheckCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            MessageSquare: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>,
            Send: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>,
            Bot: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>
        };

        // --- HELPER COMPONENTS ---

        const InputGroup = ({ label, name, value, unit, onChange, desc, step }) => (
            <div className="group">
                <label className="block text-sm font-semibold text-slate-700 mb-1 group-focus-within:text-blue-600 transition-colors">
                    {label}
                </label>
                <div className="relative">
                    <input
                        type="number"
                        name={name}
                        value={value}
                        onChange={onChange}
                        step={step || "any"}
                        className="block w-full rounded-lg border-slate-300 bg-white border px-3 py-3 text-base text-slate-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all shadow-sm outline-none"
                    />
                    <div className="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span className="text-slate-400 text-sm font-medium">{unit}</span>
                    </div>
                </div>
                {desc && <p className="mt-1 text-xs text-slate-500 leading-relaxed">{desc}</p>}
            </div>
        );

        const ResultCard = ({ title, value, unit, color, benchmark, isSafe }) => {
            const textColor = color === 'red' ? 'text-red-600' : (color === 'green' ? 'text-green-600' : 'text-slate-900');
            const borderColor = color === 'red' ? 'border-red-200 bg-red-50' : (color === 'green' ? 'border-green-200 bg-green-50' : 'border-slate-200 bg-white');

            return (
                <div className={`p-4 rounded-xl border shadow-sm ${borderColor} transition-transform hover:scale-[1.01] duration-300`}>
                    <div className="flex justify-between items-start">
                        <span className="text-xs font-bold text-slate-500 uppercase tracking-wider">{title}</span>
                        {benchmark && (
                            <span className={`text-[10px] px-2 py-0.5 rounded-full font-bold uppercase ${isSafe ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'}`}>
                                {isSafe ? 'PASS' : 'EXCEEDS'}
                            </span>
                        )}
                    </div>
                    <div className={`text-2xl md:text-3xl font-bold mt-2 ${textColor} transition-all duration-500 ease-out`}>
                        {value}
                    </div>
                    <div className="flex justify-between items-end mt-1">
                        <span className="text-xs font-medium text-slate-500">{unit}</span>
                        {benchmark && <span className="text-xs text-slate-400">Limit: {benchmark.split(': ')[1]}</span>}
                    </div>
                </div>
            );
        };

        // --- AI CHAT COMPONENT ---

        const AIChat = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([
                { role: 'model', text: "Hello! I am your research assistant. Ask me about ARGs, pathogen risks, or the formulas used." }
            ]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const messagesEndRef = useRef(null);

            const apiKey = ""; // Set by runtime environment

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages, isOpen]);

            const PAPER_CONTEXT = `
                You are a helpful expert assistant for a BioRisk Calculator App based on the paper: 
                "Pathogenic bacteria and antibiotic resistance genes in hospital indoor bioaerosols: pollution characteristics, interrelation analysis, and inhalation risk assessment" by Liu et al. (2025).
                
                Key Findings from the paper to reference:
                1. Airborne bacterial concentrations ranged from 118 to 259 CFU/m3.
                2. Dominant pathogens: Bacillus, Staphylococcus, Pseudomonas, Micrococcus.
                3. Highest ARG abundance was in respiratory wards (RW) at 479.44 copies/m3.
                4. Particle size: 27.7% were 4.7-5.8 µm. Respiratory waiting areas had highest small particles (<2.5µm).
                5. Risk: Unprotected doctors in wards face risks > EPA benchmark (10^-4). Masks reduce this significantly.
                
                Formulas used in the app:
                - ARG Dose (ADD) = (C * IR * EF * ET * ED) / (BW * AT)
                - Pathogen Dose (d) = Cs * IR * ET * AG * RR
                - Daily Risk (P_inf) = 1 - exp(-d * k)
                - Annual Risk (P_y) = 1 - (1 - P_inf)^n
                - Disease Burden (DB) = P_y * Pill/inf * HB

                Keep answers concise, helpful, and scientific. If the user asks about the calculator, explain the variables.
            `;

            const sendMessage = async () => {
                if (!input.trim()) return;
                
                const userMsg = input;
                setMessages(prev => [...prev, { role: 'user', text: userMsg }]);
                setInput('');
                setIsLoading(true);

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userMsg }] }],
                            systemInstruction: { parts: [{ text: PAPER_CONTEXT }] }
                        })
                    });

                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error.message);
                    }

                    const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || "I couldn't generate a response. Please try again.";
                    setMessages(prev => [...prev, { role: 'model', text: aiText }]);
                } catch (error) {
                    console.error("AI Error:", error);
                    setMessages(prev => [...prev, { role: 'model', text: "Sorry, I encountered an error connecting to the AI service. Please check your network." }]);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <>
                    {/* Floating Button */}
                    <button 
                        onClick={() => setIsOpen(true)}
                        className={`fixed bottom-6 right-6 p-4 bg-indigo-600 text-white rounded-full shadow-2xl hover:bg-indigo-700 transition-all z-50 btn-interactive ${isOpen ? 'hidden' : 'flex'} animate-pulse-soft`}
                    >
                        <Icons.Bot size={28} />
                    </button>

                    {/* Chat Drawer - Full width on mobile, 96px on sm+ */}
                    <div className={`fixed inset-y-0 right-0 w-full sm:w-96 bg-white shadow-2xl transform transition-transform duration-300 cubic-bezier(0.16, 1, 0.3, 1) z-50 flex flex-col ${isOpen ? 'translate-x-0' : 'translate-x-full'}`}>
                        {/* Header */}
                        <div className="p-4 border-b border-slate-200 flex justify-between items-center bg-indigo-600 text-white shadow-md z-10">
                            <div className="flex items-center gap-2">
                                <Icons.Bot size={20} />
                                <h3 className="font-bold tracking-wide">Research Assistant</h3>
                            </div>
                            <button onClick={() => setIsOpen(false)} className="hover:bg-indigo-700 p-2 rounded-full transition-colors">
                                <Icons.X size={20} />
                            </button>
                        </div>

                        {/* Messages */}
                        <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50 scroll-smooth">
                            {messages.map((msg, idx) => (
                                <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'} animate-enter`} style={{animationDelay: `${idx * 0.05}s`}}>
                                    <div className={`max-w-[85%] rounded-2xl px-4 py-3 text-sm leading-relaxed shadow-sm ${
                                        msg.role === 'user' 
                                            ? 'bg-indigo-600 text-white rounded-br-none' 
                                            : 'bg-white border border-slate-200 text-slate-800 rounded-bl-none prose'
                                    }`}>
                                        {msg.text}
                                    </div>
                                </div>
                            ))}
                            {isLoading && (
                                <div className="flex justify-start animate-enter">
                                    <div className="bg-white border border-slate-200 px-4 py-3 rounded-2xl rounded-bl-none shadow-sm">
                                        <div className="flex space-x-1.5">
                                            <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce"></div>
                                            <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                                            <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            <div ref={messagesEndRef} />
                        </div>

                        {/* Input */}
                        <div className="p-4 border-t border-slate-200 bg-white pb-safe">
                            <div className="flex gap-2 relative">
                                <input
                                    type="text"
                                    value={input}
                                    onChange={(e) => setInput(e.target.value)}
                                    onKeyDown={(e) => e.key === 'Enter' && sendMessage()}
                                    placeholder="Ask about formulas..."
                                    className="flex-1 bg-slate-100 border-0 rounded-full px-5 py-3 text-base focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all placeholder:text-slate-400"
                                />
                                <button 
                                    onClick={sendMessage}
                                    disabled={isLoading || !input.trim()}
                                    className="bg-indigo-600 text-white p-3 rounded-full hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed btn-interactive shadow-md"
                                >
                                    <Icons.Send size={20} />
                                </button>
                            </div>
                        </div>
                    </div>
                </>
            );
        };

        // --- MAIN APP COMPONENT ---

        const BioRiskCalculator = () => {
            const [activeTab, setActiveTab] = useState('arg');

            // --- ARG Dose State ---
            const [argInputs, setArgInputs] = useState({
                concentration: 48.3,
                inhalationRate: 0.63,
                exposureTime: 8,
                exposureFrequency: 250,
                exposureDuration: 30,
                bodyWeight: 70,
            });
            const [argResult, setArgResult] = useState(null);

            // --- Pathogen Risk State ---
            const [pathInputs, setPathInputs] = useState({
                concentration: 205,
                inhalationRate: 0.83,
                exposureTime: 8,
                aerosolDeposition: 50,
                maskEfficiency: 0,
                doseResponseK: 0.0000001,
                exposureDays: 250,
                illnessProb: 0.5,
                healthBurden: 0.005,
            });
            const [pathResult, setPathResult] = useState(null);

            // --- Calculations ---
            useEffect(() => {
                const { concentration, inhalationRate, exposureTime, exposureFrequency, exposureDuration, bodyWeight } = argInputs;
                const averagingTime = exposureDuration * 365;
                const dailyVolume = inhalationRate * exposureTime;
                const numerator = concentration * dailyVolume * exposureFrequency * exposureDuration;
                const denominator = bodyWeight * averagingTime;
                const add = denominator > 0 ? numerator / denominator : 0;
                setArgResult(add);
            }, [argInputs]);

            useEffect(() => {
                const { 
                    concentration, inhalationRate, exposureTime, aerosolDeposition, 
                    maskEfficiency, doseResponseK, exposureDays, illnessProb, healthBurden 
                } = pathInputs;

                const rr = (100 - maskEfficiency) / 100;
                const ag = aerosolDeposition / 100;
                
                const dose = concentration * inhalationRate * exposureTime * ag * rr;
                const dailyRisk = 1 - Math.exp(-dose * doseResponseK);
                const annualRisk = 1 - Math.pow((1 - dailyRisk), exposureDays);
                const diseaseBurden = annualRisk * illnessProb * healthBurden;

                setPathResult({ dose, dailyRisk, annualRisk, diseaseBurden });
            }, [pathInputs]);

            // --- Handlers ---
            const handleArgChange = (e) => {
                setArgInputs({ ...argInputs, [e.target.name]: parseFloat(e.target.value) || 0 });
            };

            const handlePathChange = (e) => {
                setPathInputs({ ...pathInputs, [e.target.name]: parseFloat(e.target.value) || 0 });
            };

            const TabButton = ({ id, label, icon: Icon, colorClass }) => (
                <button
                    onClick={() => setActiveTab(id)}
                    className={`
                        relative flex-1 min-w-[140px] flex items-center justify-center gap-2 px-4 py-3 rounded-xl font-medium text-sm md:text-base transition-all duration-300 btn-interactive
                        ${activeTab === id 
                            ? `${colorClass} text-white shadow-lg shadow-blue-500/20 translate-y-[-2px]` 
                            : 'bg-white text-slate-600 hover:bg-slate-50 border border-slate-200'
                        }
                    `}
                >
                    <Icon size={18} className={activeTab === id ? 'animate-pulse-soft' : ''} />
                    <span>{label}</span>
                </button>
            );

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900 pb-28 md:pb-12">
                    <div className="max-w-4xl mx-auto p-4 md:p-8">
                        
                        {/* Header */}
                        <header className="mb-6 md:mb-8 animate-enter">
                            <h1 className="text-2xl md:text-3xl font-extrabold text-slate-800 flex items-center gap-3">
                                <div className="p-2 bg-blue-100 rounded-lg text-blue-600">
                                    <Icons.Activity size={28} />
                                </div>
                                <div>
                                    AeroGuard
                                    <span className="block text-base md:text-lg font-medium text-slate-500 font-normal mt-0.5">Hospital BioRisk Analytics</span>
                                </div>
                            </h1>
                        </header>

                        {/* Navigation Tabs - Scrollable on mobile */}
                        <div className="flex gap-3 mb-6 overflow-x-auto pb-2 scrollbar-hide animate-enter" style={{animationDelay: '0.1s'}}>
                            <TabButton id="arg" label="ARG Dose" icon={Icons.Calculator} colorClass="bg-blue-600" />
                            <TabButton id="pathogen" label="Infection Risk" icon={Icons.Shield} colorClass="bg-emerald-600" />
                            <TabButton id="info" label="Info" icon={Icons.FileText} colorClass="bg-indigo-600" />
                        </div>

                        {/* Content Area */}
                        
                        {/* TAB 1: ARG DOSE */}
                        {activeTab === 'arg' && (
                            <div key="arg" className="animate-enter bg-white rounded-2xl shadow-xl shadow-slate-200/50 border border-slate-200 overflow-hidden">
                                <div className="p-5 md:p-8 grid md:grid-cols-2 gap-8">
                                    <div className="space-y-6">
                                        <div className="pb-4 border-b border-slate-100">
                                            <h2 className="text-xl font-bold text-slate-800 mb-1">Exposure Parameters</h2>
                                            <p className="text-sm text-slate-500">Calculate Average Daily Dose (ADD) of ARGs.</p>
                                        </div>

                                        <div className="space-y-5">
                                            <InputGroup 
                                                label="ARG Concentration (C)" 
                                                name="concentration" 
                                                value={argInputs.concentration} 
                                                unit="copies/m³" 
                                                onChange={handleArgChange}
                                                desc="Absolute abundance of ARGs/MGEs."
                                            />
                                            <div className="grid grid-cols-2 gap-4">
                                                <InputGroup 
                                                    label="Inhalation (IR)" 
                                                    name="inhalationRate" 
                                                    value={argInputs.inhalationRate} 
                                                    unit="m³/h" 
                                                    onChange={handleArgChange}
                                                />
                                                <InputGroup 
                                                    label="Exp. Time (ET)" 
                                                    name="exposureTime" 
                                                    value={argInputs.exposureTime} 
                                                    unit="h/day" 
                                                    onChange={handleArgChange}
                                                />
                                            </div>
                                            <InputGroup 
                                                label="Exp. Frequency (EF)" 
                                                name="exposureFrequency" 
                                                value={argInputs.exposureFrequency} 
                                                unit="days/yr" 
                                                onChange={handleArgChange}
                                            />
                                            <div className="grid grid-cols-2 gap-4">
                                                <InputGroup 
                                                    label="Duration (ED)" 
                                                    name="exposureDuration" 
                                                    value={argInputs.exposureDuration} 
                                                    unit="years" 
                                                    onChange={handleArgChange}
                                                />
                                                <InputGroup 
                                                    label="Weight (BW)" 
                                                    name="bodyWeight" 
                                                    value={argInputs.bodyWeight} 
                                                    unit="kg" 
                                                    onChange={handleArgChange}
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-slate-50 p-6 rounded-xl border border-slate-100 flex flex-col justify-center">
                                        <h3 className="text-lg font-bold text-slate-700 mb-6">Calculated Results</h3>
                                        
                                        <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 text-center mb-6 transition-transform hover:scale-[1.02] duration-300">
                                            <span className="block text-xs font-bold text-slate-400 uppercase tracking-widest mb-3">
                                                Average Daily Dose
                                            </span>
                                            <span className="block text-4xl md:text-5xl font-extrabold text-blue-600 tracking-tight break-all">
                                                {argResult !== null ? argResult.toFixed(4) : '-'}
                                            </span>
                                            <span className="text-sm font-medium text-slate-500 mt-2 block">copies / kg / day</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* TAB 2: PATHOGEN RISK */}
                        {activeTab === 'pathogen' && (
                            <div key="pathogen" className="animate-enter bg-white rounded-2xl shadow-xl shadow-slate-200/50 border border-slate-200 overflow-hidden">
                                <div className="p-5 md:p-8 grid md:grid-cols-2 gap-8">
                                    <div className="space-y-6">
                                        <div className="pb-4 border-b border-slate-100">
                                            <h2 className="text-xl font-bold text-slate-800 mb-1">QMRA Parameters</h2>
                                            <p className="text-sm text-slate-500">Risk Assessment for Staphylococcus.</p>
                                        </div>

                                        <div className="space-y-5">
                                            <InputGroup 
                                                label="Concentration (Cs)" 
                                                name="concentration" 
                                                value={pathInputs.concentration} 
                                                unit="CFU/m³" 
                                                onChange={handlePathChange}
                                            />
                                            <InputGroup 
                                                label="Mask Efficiency" 
                                                name="maskEfficiency" 
                                                value={pathInputs.maskEfficiency} 
                                                unit="%" 
                                                onChange={handlePathChange}
                                                desc="N95 ≈ 95%, Medical Mask ≈ 80%"
                                            />
                                            <div className="grid grid-cols-2 gap-4">
                                                <InputGroup 
                                                label="Inhalation (IR)" 
                                                name="inhalationRate" 
                                                value={pathInputs.inhalationRate} 
                                                unit="m³/h" 
                                                onChange={handlePathChange}
                                                />
                                                <InputGroup 
                                                label="Time (ET)" 
                                                name="exposureTime" 
                                                value={pathInputs.exposureTime} 
                                                unit="hours" 
                                                onChange={handlePathChange}
                                                />
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <InputGroup 
                                                label="Deposition (AG)" 
                                                name="aerosolDeposition" 
                                                value={pathInputs.aerosolDeposition} 
                                                unit="%" 
                                                onChange={handlePathChange}
                                                />
                                                <InputGroup 
                                                label="Days (n)" 
                                                name="exposureDays" 
                                                value={pathInputs.exposureDays} 
                                                unit="days/yr" 
                                                onChange={handlePathChange}
                                                />
                                            </div>

                                            <div className="pt-4 border-t border-slate-100">
                                                <button 
                                                onClick={() => {
                                                    const advanced = document.getElementById('advanced-params');
                                                    advanced.classList.toggle('hidden');
                                                }}
                                                className="text-sm text-blue-600 font-bold hover:text-blue-700 flex items-center gap-1 btn-interactive py-2"
                                                >
                                                Advanced Constants <Icons.Activity size={14}/>
                                                </button>
                                                <div id="advanced-params" className="hidden grid grid-cols-1 gap-4 mt-3 bg-slate-50 p-4 rounded-xl border border-slate-200 animate-enter">
                                                <InputGroup 
                                                    label="Dose-Response (k)" 
                                                    name="doseResponseK" 
                                                    value={pathInputs.doseResponseK} 
                                                    unit="const" 
                                                    onChange={handlePathChange}
                                                    step="0.0000001"
                                                />
                                                <div className="grid grid-cols-2 gap-4">
                                                    <InputGroup 
                                                        label="Prob. Illness" 
                                                        name="illnessProb" 
                                                        value={pathInputs.illnessProb} 
                                                        unit="prob" 
                                                        onChange={handlePathChange}
                                                    />
                                                    <InputGroup 
                                                        label="Health Burden" 
                                                        name="healthBurden" 
                                                        value={pathInputs.healthBurden} 
                                                        unit="DALYs" 
                                                        onChange={handlePathChange}
                                                    />
                                                </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-slate-50 p-6 rounded-xl border border-slate-100 flex flex-col justify-start space-y-4">
                                        <h3 className="text-lg font-bold text-slate-700 mb-2">Risk Characterization</h3>
                                        
                                        <ResultCard 
                                            title="Daily Inhaled Dose" 
                                            value={pathResult?.dose.toFixed(2)} 
                                            unit="CFU/day" 
                                            color="blue"
                                        />

                                        <ResultCard 
                                            title="Annual Infection Risk" 
                                            value={pathResult?.annualRisk.toExponential(2)} 
                                            unit="pppy" 
                                            color={pathResult?.annualRisk > 0.0001 ? "red" : "green"}
                                            benchmark="EPA Limit: 1.00e-4"
                                            isSafe={pathResult?.annualRisk <= 0.0001}
                                        />

                                        <ResultCard 
                                            title="Disease Burden" 
                                            value={pathResult?.diseaseBurden.toExponential(2)} 
                                            unit="DALYs pppy" 
                                            color={pathResult?.diseaseBurden > 0.000001 ? "red" : "green"}
                                            benchmark="WHO Limit: 1.00e-6"
                                            isSafe={pathResult?.diseaseBurden <= 0.000001}
                                        />

                                        <div className={`p-4 rounded-xl border text-sm mt-2 transition-colors duration-300 ${pathResult?.annualRisk > 0.0001 ? 'bg-red-50 border-red-200' : 'bg-green-50 border-green-200'}`}>
                                            <p className={`font-bold mb-1 ${pathResult?.annualRisk > 0.0001 ? 'text-red-800' : 'text-green-800'}`}>Interpretation:</p>
                                            {pathResult?.annualRisk > 0.0001 ? (
                                                <p className="text-red-700 flex items-start gap-2">
                                                    <Icons.AlertTriangle size={18} className="mt-0.5 shrink-0"/>
                                                    <span>
                                                        Annual infection risk exceeds the EPA benchmark. 
                                                        Consider using N95 masks.
                                                    </span>
                                                </p>
                                            ) : (
                                                <p className="text-green-700 flex items-start gap-2">
                                                    <Icons.CheckCircle size={18} className="mt-0.5 shrink-0"/>
                                                    <span>Risk is within acceptable EPA limits.</span>
                                                </p>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* TAB 3: INFO */}
                        {activeTab === 'info' && (
                            <div key="info" className="animate-enter bg-white rounded-2xl shadow-xl shadow-slate-200/50 border border-slate-200 overflow-hidden">
                                <div className="p-6 md:p-8">
                                    <h2 className="text-2xl font-bold text-slate-800 mb-2">Calculation Information</h2>
                                    <p className="text-slate-500 mb-8 italic text-sm md:text-base border-l-4 border-indigo-500 pl-4 py-1 bg-indigo-50/50 rounded-r-lg">
                                        Based on "Pathogenic bacteria and antibiotic resistance genes in hospital indoor bioaerosols" (Liu et al., 2025).
                                    </p>
                                    
                                    <div className="prose prose-slate max-w-none text-slate-600">
                                        <div className="mb-8">
                                            <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2 mb-3">
                                                <span className="bg-blue-100 text-blue-700 w-6 h-6 rounded-full flex items-center justify-center text-xs">1</span>
                                                ARG Inhalation Dose (ADD)
                                            </h3>
                                            <div className="bg-slate-50 p-5 rounded-xl border border-slate-200 text-sm">
                                                <p className="font-mono bg-white p-2 rounded border border-slate-200 mb-4 text-center overflow-x-auto">ADD = (C × IR × EF × ET × ED) / (BW × AT)</p>
                                                <ul className="space-y-2 mt-3 list-none pl-0">
                                                    <li><strong className="text-blue-700">C (Concentration):</strong> The absolute abundance of ARGs or MGEs in the air, measured in copies/m³.</li>
                                                    <li><strong className="text-blue-700">IR (Inhalation Rate):</strong> The volume of air a person inhales per hour (m³/h). Standard adult approx 0.63-0.83 m³/h.</li>
                                                    <li><strong className="text-blue-700">EF (Exposure Frequency):</strong> How often exposure occurs, typically days per year (e.g., 250 work days).</li>
                                                    <li><strong className="text-blue-700">ET (Exposure Time):</strong> The duration of exposure per day (e.g., 8 hours/day).</li>
                                                    <li><strong className="text-blue-700">ED (Exposure Duration):</strong> The total number of years the exposure lasts (e.g., 30 years).</li>
                                                    <li><strong className="text-blue-700">BW (Body Weight):</strong> The average body weight of the exposed individual (kg).</li>
                                                    <li><strong className="text-blue-700">AT (Averaging Time):</strong> The period over which exposure is averaged (ED × 365 days).</li>
                                                </ul>
                                            </div>
                                        </div>

                                        <div className="mb-8">
                                            <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2 mb-3">
                                                <span className="bg-emerald-100 text-emerald-700 w-6 h-6 rounded-full flex items-center justify-center text-xs">2</span>
                                                QMRA (Dose, Risk & Burden)
                                            </h3>
                                            <div className="bg-slate-50 p-5 rounded-xl border border-slate-200 text-sm">
                                                 <div className="grid gap-2 mb-4">
                                                    <p className="font-mono bg-white p-2 rounded border border-slate-200 text-xs md:text-sm text-center">Daily Inhalation Dose (d) = Cs × IR × ET × AG × RR</p>
                                                    <p className="font-mono bg-white p-2 rounded border border-slate-200 text-xs md:text-sm text-center">Daily Infection Risk (P_inf) = 1 - e^(-d × k)</p>
                                                    <p className="font-mono bg-white p-2 rounded border border-slate-200 text-xs md:text-sm text-center">Annual Infection Risk (P_y) = 1 - (1 - P_inf)^n</p>
                                                    <p className="font-mono bg-white p-2 rounded border border-slate-200 text-xs md:text-sm text-center">Disease Burden (DB) = P_y × Pill/inf × HB</p>
                                                 </div>

                                                <ul className="space-y-2 list-none pl-0 mb-5">
                                                    <li><strong className="text-emerald-700">Cs (Concentration):</strong> Airborne pathogen concentration (CFU/m³).</li>
                                                    <li><strong className="text-emerald-700">AG (Aerosol Deposition):</strong> The fraction of inhaled particles that deposit in the respiratory tract (%).</li>
                                                    <li><strong className="text-emerald-700">RR (Respiratory Intake):</strong> The fraction of particles that penetrate a mask (100% - Mask Efficiency).</li>
                                                    <li><strong className="text-emerald-700">k (Dose-Response Constant):</strong> A pathogen-specific constant representing infectivity probability per organism.</li>
                                                    <li><strong className="text-emerald-700">n (Exposure Days):</strong> Number of days exposed per year.</li>
                                                    <li><strong className="text-emerald-700">Pill/inf (Illness Probability):</strong> The likelihood of developing symptoms if infected.</li>
                                                    <li><strong className="text-emerald-700">HB (Health Burden):</strong> The severity of the outcome, measured in Disability-Adjusted Life Years (DALYs) per case.</li>
                                                </ul>

                                                <div className="pt-5 border-t border-slate-200">
                                                    <h4 className="font-bold text-slate-700 mb-2 flex items-center gap-2">
                                                        <span className="w-1.5 h-1.5 rounded-full bg-emerald-400"></span>
                                                        Parameter Source Estimation
                                                    </h4>
                                                    <ul className="list-disc pl-5 space-y-1.5 text-slate-600">
                                                        <li><strong>Dose-Response Constant (k):</strong> The infectivity constant for <em>Staphylococcus</em> was adopted from the exponential model established by Esfahanian et al. (2019).</li>
                                                        <li><strong>Mask Efficiency:</strong> Filtration efficiencies were defined based on standardized equipment ratings:
                                                            <ul className="list-[circle] pl-5 mt-1 text-xs space-y-1">
                                                                <li>N95 Respirators: 95% efficiency (RR = 0.05).</li>
                                                                <li>Surgical/Medical Masks: ~80% efficiency (RR = 0.20).</li>
                                                            </ul>
                                                        </li>
                                                        <li><strong>Health Burden (HB):</strong> DALYs per case were derived from WHO Global Health Estimates for specific staphylococcal infection outcomes.</li>
                                                        <li><strong>Exposure Factors:</strong> Standard physiological values (Inhalation Rate, Body Weight) were sourced from the US EPA <em>Exposure Factors Handbook</em>.</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="mb-6">
                                            <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2 mb-3">
                                                <span className="bg-purple-100 text-purple-700 w-6 h-6 rounded-full flex items-center justify-center text-xs">3</span>
                                                Methodology: Sampling & Estimation
                                            </h3>
                                            <div className="bg-slate-50 p-5 rounded-xl border border-slate-200 text-sm">
                                                <div className="mb-5">
                                                    <h4 className="font-bold text-slate-700 mb-2 flex items-center gap-2">
                                                        <span className="w-1.5 h-1.5 rounded-full bg-purple-400"></span>
                                                        Bioaerosol Sampling (Particle Size & Cs)
                                                    </h4>
                                                    <ul className="list-disc pl-5 space-y-1.5 text-slate-600">
                                                        <li><strong>Equipment:</strong> Six-stage Anderson impactor (simulates human respiratory tract deposition).</li>
                                                        <li><strong>Procedure:</strong> Samples collected at breathing height (1.5m) at a flow rate of 28.3 L/min for 10–20 minutes.</li>
                                                        <li><strong>Particle Size Est.:</strong> Separated physically by impactor stages:
                                                            <ul className="list-[circle] pl-5 mt-1 text-xs space-y-1">
                                                                <li>Stages 1-2 (> 4.7 µm): Deposited in Upper Respiratory Tract.</li>
                                                                <li>Stages 3-6 (&lt; 4.7 µm): Deposited in Lower Respiratory Tract (Respirable).</li>
                                                            </ul>
                                                        </li>
                                                        <li><strong>Pathogen Conc. (Cs):</strong> Cultured on nutrient agar at 37°C for 48h.
                                                            <p className="font-mono bg-white p-1.5 rounded border border-slate-200 mt-1 text-xs">
                                                                Cs (CFU/m³) = (Total Colonies × 1000) / (28.3 × Time)
                                                            </p>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div>
                                                    <h4 className="font-bold text-slate-700 mb-2 flex items-center gap-2">
                                                        <span className="w-1.5 h-1.5 rounded-full bg-purple-400"></span>
                                                        ARG Concentration Estimation
                                                    </h4>
                                                    <ul className="list-disc pl-5 space-y-1.5 text-slate-600">
                                                        <li><strong>Materials:</strong> FastDNA Spin Kit for Soil (for DNA extraction from membranes).</li>
                                                        <li><strong>Analysis:</strong> High-throughput qPCR (HT-qPCR) targeting 300+ ARGs and MGEs using a SmartChip Real-time PCR system.</li>
                                                        <li><strong>Calculation Procedure:</strong>
                                                             <p className="font-mono bg-white p-1.5 rounded border border-slate-200 mt-1 text-xs">
                                                                Absolute Abundance (copies/m³) = (Copies/ng DNA × DNA Yield) / Air Volume
                                                             </p>
                                                             <span className="text-xs text-slate-500 block mt-1">
                                                                 *The relative abundance (copies/16S rRNA) is normalized against the 16S rRNA gene copy number to derive the absolute concentration in air.
                                                             </span>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        
                                         <h3 className="text-lg font-bold text-slate-800 mt-8 mb-3">Key Study Findings</h3>
                                         <ul className="list-disc pl-5 space-y-2 text-sm bg-indigo-50 p-4 rounded-xl text-indigo-900 border border-indigo-100">
                                            <li><strong>Dominant Pathogens:</strong> <em>Bacillus, Staphylococcus, Pseudomonas,</em> and <em>Micrococcus</em>.</li>
                                            <li><strong>ARG Hotspots:</strong> Respiratory wards (RW) had highest ARG abundance (479.44 copies/m³).</li>
                                            <li><strong>Inhalation Dose:</strong> The study found doctors inhaled higher doses in inpatient wards (0.47 copies/d/kg) compared to outpatient areas. The respiratory ward had the highest risk.</li>
                                            <li><strong>Risk:</strong> Unprotected doctors in wards faced risks exceeding EPA benchmarks.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        )}

                        </div>
                    
                    {/* Floating AI Assistant */}
                    <AIChat />

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BioRiskCalculator />);
    </script>
</body>

</html>
